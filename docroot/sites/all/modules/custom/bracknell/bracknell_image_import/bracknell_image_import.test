<?php

class BracknellImageImportFilenameTest extends DrupalUnitTestCase {

  /**
   * {@inheritdoc}
   */
  public static function getInfo() {
    return array(
      'name' => 'Bracknell Image Import unit tests',
      'description' => '',
      'group' => 'bracknell',
    );
  }

  /**
   * {@inheritdoc}
   */
  protected function setUp() {
    drupal_load('module', 'bracknell_image_import');

    parent::setUp();
  }

  public function testDuplicateFilenamesAreChanged() {
    foreach ($this->filenameAndUriDataProvider() as $data) {
      list($expected_filename, $existing_uris) = $data;

      $filename = _bracknell_image_import_get_filename('public://foo.jpg', $existing_uris);

      $this->assertEqual($expected_filename, $filename);
    }
  }

  private function filenameAndUriDataProvider() {
    return array(
      array('public://foo.jpg', array('public://foo.jpg')),
      array('public://foo.jpg', array('s3://foo.jpg')),
      array('public://foo-0.jpg', array('s3://foo.jpg', 'public://foo.jpg')),
      array('public://foo-1.jpg', array('public://foo.jpg', 'public://foo.jpg', 's3://foo.jpg')),
      array('public://foo-1.jpg', array('s3://foo.jpg', 'public://foo.jpg', 's3://foo.jpg')),
      array('public://foo-2.jpg', array('public://foo.jpg', 'public://bar.jpg', 's3://foo.jpg', 'public://baz.jpg', 'public://foo.jpg', 's3://bar.jpg', 'public://foo.jpg'))
    );
  }

}
